"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var language_1 = require("../locale/language");
/**
 * Poll a particular function until a specified interval/timeout.
 */
var PollUtil = /** @class */ (function () {
    function PollUtil() {
    }
    /**
     * Method used for polling.
     * @param fn Function that needs to be polled.
     * @param timeout Time after which the polling will stop.
     * @param interval Time difference between calls while polling.
     */
    PollUtil.poll = function (fn, timeout, interval) {
        var endTime = Number(new Date()) + (timeout || 2000);
        interval = interval || 1000;
        var checkCondition = function (resolve, reject) {
            fn()
                .then(function (response) {
                resolve(response);
            })
                .catch(function (error) {
                var message = error.message;
                if (message && message.indexOf('403') > -1) {
                    reject(new Error("403 - " + language_1.Language.GetResource().consent_rejected));
                }
                else if (Number(new Date()) < endTime) {
                    setTimeout(checkCondition, interval, resolve, reject);
                }
                else {
                    reject(new Error("408 - " + language_1.Language.GetResource().timed_out));
                }
            });
        };
        return new Promise(checkCondition);
    };
    return PollUtil;
}());
exports.PollUtil = PollUtil;
